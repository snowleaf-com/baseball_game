#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# プロジェクトルートを取得
PROJECT_ROOT="$(git rev-parse --show-toplevel)"
cd "$PROJECT_ROOT/frontend" || exit 1

# frontend ディレクトリ内のファイルのみを対象にする
# lint-stagedはGitのステージングエリア全体を見るので、
# --diffオプションでfrontend/で始まるファイルのみをフィルタリング
cd "$PROJECT_ROOT" || exit 1
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep "^frontend/" || true)
if [ -n "$STAGED_FILES" ]; then
  cd "$PROJECT_ROOT/frontend" || exit 1
  # lint-stagedを実行（frontendディレクトリ内で実行し、プロジェクトルートのGitリポジトリを参照）
  pnpm lint-staged
else
  echo "No frontend files staged, skipping lint-staged"
fi

# 型チェックは常に実行（frontend内のファイルのみ）
cd "$PROJECT_ROOT/frontend" || exit 1
pnpm type-check

